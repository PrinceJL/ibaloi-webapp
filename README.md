# Translation API

A Google Apps Script-based API for managing sentence translations with automatic wordlist generation.

## 📋 Overview

This API provides endpoints to fetch untranslated sentences and save translations back to a Google Sheets database. It automatically generates CSV wordlists from translations and includes basic rate limiting.

## 🚀 Features

- **Fetch untranslated sentences** - Get random sentences that need translation
- **Save translations** - Store translations with automatic wordlist generation
- **Rate limiting** - Built-in protection (5 requests per minute per client)
- **Google Sheets integration** - Data stored in spreadsheet format

## 📊 Data Structure

The API expects a Google Sheets document with a "SentenceList" sheet containing:

| Column A | Column B | Column C |
|----------|----------|----------|
| English | WordList | Translation |

## 🔗 API Endpoint

```
https://script.google.com/macros/s/AKfycbwDsmJEmfVwHGwNWSGEzOB-CMC2Bv1tCXntSJEhe8m1wyFWM7j5IhpwUfksKst0_6Vftw/exec
```

## 📖 API Reference

### GET - Fetch Untranslated Sentences

Retrieves random sentences that have no wordlist and no translation.

**Parameters:**
- `count` (optional): Number of sentences to return (default: 1)

**Example:**
```bash
GET ?count=5
```

**Response:**
```json
[
  {
    "english": "The sun rises in the east.",
    "wordlist": "",
    "translation": ""
  }
]
```

**Error Responses:**
```json
{ "error": "No data available" }
{ "message": "No untranslated sentences left" }
```

### POST - Save Translation

Saves a translation and generates a CSV wordlist.

**Request Body:**
```json
{
  "english": "The sun rises in the east.",
  "translation": "Le soleil se lève à l'est."
}
```

**Response:**
```json
{
  "status": "saved",
  "english": "The sun rises in the east.",
  "wordlist": "Le,soleil,se,lève,à,l'est.",
  "translation": "Le soleil se lève à l'est."
}
```

**Rate Limit Response:**
```json
{ "error": "Rate limit exceeded. Try again later." }
```

## 🛠️ Setup

1. Create a Google Sheets document with a "SentenceList" sheet
2. Set up the column structure (English | WordList | Translation)
3. Deploy the Google Apps Script as a web app
4. Configure permissions for external access

## ⚡ Usage Examples

### JavaScript/Fetch
```javascript
// Get 3 untranslated sentences
fetch('YOUR_SCRIPT_URL?count=3')
  .then(response => response.json())
  .then(data => console.log(data));

// Save a translation
fetch('YOUR_SCRIPT_URL', {
  method: 'POST',
  body: JSON.stringify({
    english: "Hello world",
    translation: "Hola mundo"
  })
})
.then(response => response.json())
.then(data => console.log(data));
```

### cURL
```bash
# Get sentences
curl "YOUR_SCRIPT_URL?count=2"

# Save translation
curl -X POST YOUR_SCRIPT_URL \
  -H "Content-Type: application/json" \
  -d '{"english":"Hello","translation":"Hola"}'
```

## Rate Limiting

- **Limit:** 5 requests per minute per client
- **Identification:** Based on client address and request type
- **Reset:** Automatic after 60 seconds

## Architecture

The system consists of:
- **Google Apps Script** - Server-side logic and API endpoints
- **Google Sheets** - Data storage and management
- **Cache Service** - Rate limiting implementation

## Notes

- Wordlists are automatically generated by splitting translations on whitespace
- Empty or whitespace-only wordlists and translations are considered "incomplete"
- The API returns random sentences to ensure variety in translation tasks